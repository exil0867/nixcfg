<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="./exil - Personal page">
    <title>./exil</title>
    <link rel="icon" href="assets/avatar.jpeg">
    <link rel="apple-touch-icon" href="assets/avatar.jpeg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap');

        :root {
            --primary-color: #efff00;
            --secondary-color: #fe00cf;
            --tertiary-color: #7c87d2;
            --quaternary-color: #656565;
            --green: #07d404;
            --red: #ff0000;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        html {
            overflow: scroll;
            overflow-x: hidden;
            scrollbar-width: none;
        }

        ::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        body {
            margin: 0;
            background-color: #000;
            font-weight: 400;
            color: var(--primary-color);
            padding: 75px 15px;
            text-align: center;
            display: flex;
            justify-content: center;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            font-family: 'Inconsolata', monospace;
            font-size: 1.070rem;
            line-height: 1.65;
        }

        @media screen and (max-width:767.98px) {
            body {
                padding: 60px 15px;
                font-size: 1rem;
            }
        }

        pre {
            font-size: 0.850em;
            display: block;
            margin-top: 0;
            margin-bottom: 1rem;
            white-space: normal;
            word-break: break-all;
        }

        pre, code {
            font-family: monospace, monospace;
            color: var(--quaternary-color);
        }

        ul {
            padding: 0;
            margin: 0;
            margin-bottom: 1rem;
        }

        ul li {
            list-style: none;
            margin: 0;
        }

        ul li:not(:last-child) {
            margin-bottom: 0.65em;
        }

        ul li > p {
            margin: 0;
        }

        .small-header {
            font-weight: bolder;
            color: var(--secondary-color);
        }

        a {
            color: var(--tertiary-color);
        }

        img {
            height: auto;
            max-width: 100%;
            vertical-align: middle;
        }

        [hidden] {
            display: none;
        }

        h1, h2, h3, h4, h5, h6 {
            margin-top: 0;
            margin-bottom: 0.7rem;
            font-weight: bolder;
            line-height: 1.8;
            color: var(--secondary-color);
        }

        h1 {
            font-size: calc(1.375rem + 1.5vw);
        }

        @media (min-width: 1200px) {
            h1 {
                font-size: 2.5rem;
            }
        }

        h2 {
            font-size: calc(1.325rem + 0.9vw);
        }

        @media (min-width: 1200px) {
            h2 {
                font-size: 2rem;
            }
        }

        h3 {
            font-size: calc(1.3rem + 0.6vw);
        }

        @media (min-width: 1200px) {
            h3 {
                font-size: 1.75rem;
            }
        }

        h4 {
            font-size: calc(1.275rem + 0.3vw);
        }

        @media (min-width: 1200px) {
            h4 {
                font-size: 1.5rem;
            }
        }

        p {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 0.75em;
        }

        small {
            display: block;
        }

        section:not(:last-child) {
            margin-bottom: 34px;
        }

        section > *:first-child {
            margin-top: 0;
        }

        section > *:last-child {
            margin-bottom: 0;
        }

        .avatar {
            margin-top: 1rem;
            margin-bottom: 1.7rem;
            border-radius: 50%;
            width: 150px;
            cursor: pointer;
        }

        .container {
            width: 390px;
        }

        .bio-padding {
            padding: 0 38px;
        }

        .footer-section {
            margin-top: 3rem;
        }

        .repo-link {
            text-transform: uppercase;
            color: var(--green);
            text-decoration: none;
        }

        .second-bio {
            font-weight: 300;
        }

        /* Metrics styles */
        .metrics-section {
            border: 1px solid var(--quaternary-color);
            padding: 1rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.02);
        }

        .host-metrics {
            margin-bottom: 0.8rem;
            text-align: left;
            padding: 0.5rem 0.6rem;
            background: none;
            border-left: 2px solid var(--tertiary-color);
        }

        .host-metrics:last-child {
            margin-bottom: 0;
        }

        .host-name {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            width: 6px;
            height: 6px;
        }


        .status-online {
            background-color: var(--green);
            box-shadow: 0 0 5px var(--green);
        }

        .status-offline {
            background-color: var(--red);
        }

        .metric-line {
            font-family: 'Inconsolata', monospace;
            font-size: 0.85rem;
            margin: 0.15rem 0;
            color: var(--primary-color);
            letter-spacing: 0.02em;
        }

        .metric-label {
            display: inline-block;
            width: 45px;
            color: var(--quaternary-color);
        }

        .metric-value {
            color: var(--primary-color);
            font-weight: bold;
        }

        .connection-status {
            text-align: center;
            font-size: 0.85rem;
            color: var(--quaternary-color);
            margin-top: 0.5rem;
        }

        .connection-status.connected {
            color: var(--green);
        }

        .connection-status.disconnected {
            color: var(--red);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- About Me -->
        <section>
            <h1>
                <a class="repo-link" target="_blank" title="The source code of this page" 
                   href="https://github.com/exil0867/3x1l" rel="noreferrer">
                    3x!1
                </a>
            </h1>
            <img src="assets/avatar.jpeg" class="avatar" alt="Avatar" onclick="toggleBio()">
            <h4>exiluuuuuuu</h4>
            <div id="secondBio" class="second-bio" hidden>
                <p><small>(・_・ヾ)</small></p>
            </div>
            <div class="bio-padding">
                <p>__software_dev__</p>
                <p>__sysadmin__</p>
                <p>__ui/ux_design__</p>
            </div>
        </section>

        <!-- Intro -->
        <section>
            <small class="small-header">~</small>
            <p>
                <a href="https://github.com/exil0867/nixcfg" target="_blank">My Homelab setup</a>
            </p>
        </section>

        <!-- Socials -->
        <section>
            <h4>My @'s</h4>
            <ul>
                <li><p><a href="tg://resolve?domain=exil0967">Telegram</a></p></li>
                <li><p><a href="https://github.com/exil0867" target="_blank">Github</a></p></li>
                <li><p><a href="https://matrix.to/#/@exil0816:ira.moe" target="_blank">Matrix</a></p></li>
                <li><p><a href="https://x.com/exil0867" target="_blank">X</a></p></li>
                <li><p><a href="https://steamcommunity.com/id/exil0839" target="_blank">Steam</a></p></li>
                <li><p><a href="https://anilist.co/user/exil0685" target="_blank">AniList</a></p></li>
                <li><p><a href="https://last.fm/user/exil0908" target="_blank">Last.fm</a></p></li>
            </ul>
        </section>

        <!-- Contact -->
        <section>
            <h4>Contact</h4>
            <p>
                Email: <a href="mailto:contact@n0t3x1l.dev">contact@n0t3x1l.dev</a>
            </p>
        </section>

        <!-- Support -->
        <section>
            <h4>Support</h4>
            <ul>
                <li>
                    <p>GitHub Sponsors:</p>
                    <pre><a target="_blank" rel="noreferrer" href="https://github.com/sponsors/exil0867">sponsors/exil0867</a></pre>
                </li>
                <li>
                    <p>BTC:</p>
                    <pre>17nFjdytthofdha6aSmBDSHnb9NcSAhd8Z</pre>
                </li>
                <li>
                    <p>BTC (Bech32):</p>
                    <pre>bc1q0rhwyzc8upxjzn0qddz2rhv86xh3qvsydjn865</pre>
                </li>
                <li>
                    <p>ETH:</p>
                    <pre>0x677C5728D3E26152187Cc98E06CB47A58EF58eaA</pre>
                </li>
                <li>
                    <p>XMR:</p>
                    <pre>46SXLx7PGvm4u7FnDvNvoPYu48AP4fUfbHwCDw6koxbhUrT1bSYvuHe7et7q8uSJ52NJApxXUyLmX7AaJP7ysXcLRyeZaaz</pre>
                </li>
            </ul>
        </section>

        <!-- Resources -->
        <section>
            <h4>Good resources</h4>
            <ul>
                <li><p><a href="https://igwiki.lyci.de/wiki/Main_Page" target="_blank">InstallGentoo Wiki</a></p></li>
                <li><p><a href="https://boards.4channel.org/g/#catalog" target="_blank">/g/</a></p></li>
                <li><p><a href="https://lainchan.org" target="_blank">LAINCHAN</a></p></li>
                <li><p><a href="https://www.privacyguides.org" target="_blank">PrivacyGuides</a></p></li>
                <li><p><a href="https://news.ycombinator.com" target="_blank">HackerNews</a></p></li>
                <li><p><a href="https://wiki.archlinux.org/title/Table_of_contents" target="_blank">ArchWiki</a></p></li>
            </ul>
        </section>

        <!-- System Metrics -->
        <section>
            <h4>System Status</h4>
            <div class="metrics-section">
                <div id="metrics-container">
                    <p style="color: var(--quaternary-color); text-align: center;">
                        Connecting to metrics server...
                    </p>
                </div>
                <div class="connection-status" id="connection-status">
                    Connecting...
                </div>
            </div>
        </section>

        <!-- Footer -->
        <section class="footer-section">
            <small>
                Check out the 
                <a href="https://github.com/exil0867/nixcfg/tree/master/modules/services/personal-website" target="_blank">source code</a>.
            </small>
        </section>
    </div>

    <script>
    // Toggle bio easter egg
    function toggleBio() {
        const bio = document.getElementById('secondBio');
        bio.hidden = !bio.hidden;
    }

    // Server-Sent Events connection for real-time metrics
    let eventSource = null;
    let reconnectTimer = null;

    function connectSSE() {
        if (eventSource) {
            eventSource.close();
        }
        
        const sseUrl = `${window.location.protocol}//${window.location.host}/ws/metrics`;
        console.log('Connecting to SSE:', sseUrl);
        
        eventSource = new EventSource(sseUrl);
        
        eventSource.onopen = () => {
            console.log('SSE connected');
            updateConnectionStatus(true);
            if (reconnectTimer) {
                clearTimeout(reconnectTimer);
                reconnectTimer = null;
            }
        };
        
        eventSource.onmessage = (event) => {
            try {
                // Skip keep-alive comments
                if (event.data.trim().startsWith(':')) {
                    return;
                }
                
                const metrics = JSON.parse(event.data);
                updateMetrics(metrics);
            } catch (e) {
                console.error('Failed to parse metrics:', e, 'Data:', event.data);
            }
        };
        
        eventSource.onerror = (error) => {
            console.error('SSE error:', error);
            updateConnectionStatus(false);
            
            // Close and reconnect
            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }
            
            // Reconnect after 3 seconds
            if (!reconnectTimer) {
                reconnectTimer = setTimeout(() => {
                    console.log('Attempting to reconnect...');
                    connectSSE();
                }, 3000);
            }
        };
    }

    function updateConnectionStatus(connected) {
        const statusEl = document.getElementById('connection-status');
        if (connected) {
            statusEl.textContent = 'Connected';
            statusEl.className = 'connection-status connected';
        } else {
            statusEl.textContent = 'Disconnected - Reconnecting...';
            statusEl.className = 'connection-status disconnected';
        }
    }

    function updateMetrics(metrics) {
        const container = document.getElementById('metrics-container');
        
        // Sort hosts: kairos, echo, sky
        const hostOrder = ['kairos', 'echo', 'sky'];
        const sortedHosts = Object.keys(metrics).sort((a, b) => {
            const indexA = hostOrder.indexOf(a);
            const indexB = hostOrder.indexOf(b);
            if (indexA === -1 && indexB === -1) return a.localeCompare(b);
            if (indexA === -1) return 1;
            if (indexB === -1) return -1;
            return indexA - indexB;
        });
        
        if (sortedHosts.length === 0) {
            container.innerHTML = '<p style="color: var(--quaternary-color); text-align: center;">No metrics available</p>';
            return;
        }
        
        container.innerHTML = sortedHosts.map(hostname => {
            const data = metrics[hostname];
            const isOnline = data.status === 'online';
            
            return `
                <div class="host-metrics">
                    <div class="host-name">
                        <span>${hostname}</span>
                        <span style="color: ${isOnline ? 'var(--green)' : 'var(--red)'}">
                            ${isOnline ? 'online' : 'offline'}
                        </span>
                    </div>
                    ${isOnline ? `
                        <div class="metric-line">
                            <span style="color: var(--quaternary-color)">CPU</span> ${(data.cpu || 0).toFixed(1)}%
                        </div>
                        <div class="metric-line">
                            <span style="color: var(--quaternary-color)">MEM</span> ${(data.ram || 0).toFixed(1)}%
                        </div>
                        ${data.gpu !== null && data.gpu !== 'null' ? `
                        <div class="metric-line">
                            <span style="color: var(--quaternary-color)">GPU</span> ${data.gpu}%
                        </div>
                        ` : ''}
                    ` : '<p style="color: var(--red); margin: 0; font-size: 0.9rem;">Offline - No recent data</p>'}
                </div>
            `;
        }).join('');
    }

    // Connect on page load
    window.addEventListener('load', () => {
        setTimeout(connectSSE, 1000); // Small delay to ensure page is loaded
    });

    // Reconnect when page becomes visible
    document.addEventListener('visibilitychange', () => {
        if (!document.hidden && !eventSource) {
            connectSSE();
        }
    });
</script>
</body>
</html>